<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>BHYT Pharma Tracker - Tra C·ª©u Thu·ªëc BHYT</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.2/package/dist/xlsx.full.min.js"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script type="importmap">
        {
            "imports": {
                "lucide-react": "https://unpkg.com/lucide-react@latest/dist/esm/lucide-react.js"
            }
        }
    </script>
    <style>
        * {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
        }
        
        *:not(input):not(textarea):not([contenteditable="true"]) {
            user-select: none;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #f0f7ff 0%, #e6f0ff 100%);
            min-height: 100vh;
        }
        
        .card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 82, 204, 0.15);
        }
        
        .medicine-card {
            border-left: 4px solid;
            transition: all 0.3s ease;
            background: linear-gradient(to right, white 96%, var(--border-color) 4%);
        }
        
        .search-highlight {
            background-color: rgba(59, 130, 246, 0.25);
            padding: 0 2px;
            border-radius: 3px;
            font-weight: 600;
        }
        
        .sync-pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(34, 197, 94, 0); }
            100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
        }
        
        .offline-badge {
            animation: blink 2s infinite;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .status-online { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        .status-offline { background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%); }
        .status-syncing { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
        
        .data-source-badge {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
        }
        
        .network-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        
        .network-online { background-color: #10b981; box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.2); }
        .network-offline { background-color: #ef4444; box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.2); }
        
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>
<body class="min-h-screen text-gray-800">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        const { useState, useEffect, useRef, useCallback } = React;

        // Lucide Icons
        const LucideIcons = {
            Search: () => React.createElement('i', { className: 'fas fa-search' }),
            Pill: () => React.createElement('i', { className: 'fas fa-pills' }),
            AlertCircle: () => React.createElement('i', { className: 'fas fa-exclamation-circle' }),
            FileText: () => React.createElement('i', { className: 'fas fa-file-medical-alt' }),
            Share2: () => React.createElement('i', { className: 'fas fa-share-alt' }),
            Download: () => React.createElement('i', { className: 'fas fa-download' }),
            Filter: () => React.createElement('i', { className: 'fas fa-filter' }),
            Star: () => React.createElement('i', { className: 'fas fa-star' }),
            X: () => React.createElement('i', { className: 'fas fa-times' }),
            Info: () => React.createElement('i', { className: 'fas fa-info-circle' }),
            BookOpen: () => React.createElement('i', { className: 'fas fa-book-open' }),
            Heart: () => React.createElement('i', { className: 'fas fa-heart' }),
            AlertTriangle: () => React.createElement('i', { className: 'fas fa-exclamation-triangle' }),
            CheckCircle: () => React.createElement('i', { className: 'fas fa-check-circle' }),
            Calendar: () => React.createElement('i', { className: 'fas fa-calendar-alt' }),
            User: () => React.createElement('i', { className: 'fas fa-user-md' }),
            Database: () => React.createElement('i', { className: 'fas fa-database' }),
            Wifi: () => React.createElement('i', { className: 'fas fa-wifi' }),
            WifiOff: () => React.createElement('i', { className: 'fas fa-wifi-slash' }),
            Refresh: () => React.createElement('i', { className: 'fas fa-sync-alt' }),
            Upload: () => React.createElement('i', { className: 'fas fa-upload' }),
            Cloud: () => React.createElement('i', { className: 'fas fa-cloud' }),
            FileExcel: () => React.createElement('i', { className: 'fas fa-file-excel' }),
            History: () => React.createElement('i', { className: 'fas fa-history' }),
            Shield: () => React.createElement('i', { className: 'fas fa-shield-alt' }),
            NetworkWired: () => React.createElement('i', { className: 'fas fa-network-wired' })
        };

        // Storage Keys
        const STORAGE_KEYS = {
            FAVORITES: 'bhyt_favorites_v2',
            MEDICINE_DATA: 'bhyt_medicine_data_v2',
            LAST_SYNC: 'bhyt_last_sync_v2',
            USER_ADDED: 'bhyt_user_added_data_v2',
            SYNC_ENABLED: 'bhyt_sync_enabled_v2'
        };

        // Default Excel Data (full dataset from the file)
        const defaultExcelData = [
            {"Stt": "1.0", "T√™n th∆∞∆°ng m·∫°i": "Tipharmlor", "T√™n, HC, HL": "Amlodipin", "Li·ªÅu d√πng": "1-2 x 1", "M√£ ICD": "I10 - B·ªánh l√Ω THA"},
            {"Stt": "2.0", "T√™n th∆∞∆°ng m·∫°i": "Panactol", "T√™n, HC, HL": "Paracetamol (acetaminophen)", "Li·ªÅu d√πng": "1 x 2", "M√£ ICD": "R51 - ƒêau ƒë·∫ßu; G44.2 - ƒêau ƒë·∫ßu do cƒÉng th·∫≥ng; M54 - ƒêau l∆∞ng; J00 - VieÃÇm m≈©i h·ªçng c·∫•p [c·∫£m thuÃõ·ªùng]; M25.5 - ƒêau kh·ªõp; M79.1 - ƒêau c∆°"},
            {"Stt": "3.0", "T√™n th∆∞∆°ng m·∫°i": "piroxicam", "T√™n, HC, HL": "piroxicam 20mg", "Li·ªÅu d√πng": "1 x 1", "M√£ ICD": "Ch·ªëng vi√™m kh√¥ng steroid: vi√™m kh·ªõp d·∫°ng th·∫•p, vi√™m x∆∞∆°ng kh·ªõp (TH kh·ªõp, b·ªánh kh·ªõp), vi√™m d√≠nh CS, g√∫t c·∫•p, th·ªëng kinh LD: 1v x 1, g√∫t c·∫•p 1v x 2"},
            {"Stt": "4.0", "T√™n th∆∞∆°ng m·∫°i": "Kagasdine", "T√™n, HC, HL": "Omeprazol", "Li·ªÅu d√πng": "1 x 1", "M√£ ICD": "K21 - GERD; K25 -LDD (ko K29 vi√™m DDTT)"},
            {"Stt": "5.0", "T√™n th∆∞∆°ng m·∫°i": "Domperidon", "T√™n, HC, HL": "Domperidon 10mg", "Li·ªÅu d√πng": "10mg", "M√£ ICD": "R11 - Bu·ªìn n√¥n & n√¥n"},
            {"Stt": "6.0", "T√™n th∆∞∆°ng m·∫°i": "Bromhexin", "T√™n, HC, HL": "Bromhexin (hydroclorid)", "Li·ªÅu d√πng": "8mg x 3", "M√£ ICD": "J20 - VPQ c·∫•p"},
            {"Stt": "7.0", "T√™n th∆∞∆°ng m·∫°i": "AGICETAM 400", "T√™n, HC, HL": "", "Li·ªÅu d√πng": "2 x 2", "M√£ ICD": "H81.3 - Ch√≥ng m·∫∑t do nguy√™n nh√¢n ngo·∫°i bi√™n kh√°c; H81.1 - Ch√≥ng m·∫∑t k·ªãch ph√°t l√†nh t√≠nh; R42 - Hoa m·∫Øt & ch√≥ng m·∫∑t (ok); M·∫•t ng·ªß cho d·ªÖ ng·ªß"},
            {"Stt": "8.0", "T√™n th∆∞∆°ng m·∫°i": "AGICETAM 800", "T√™n, HC, HL": "Piracetam 400; 800", "Li·ªÅu d√πng": "1 x 2", "M√£ ICD": "H81.3 - Ch√≥ng m·∫∑t do nguy√™n nh√¢n ngo·∫°i bi√™n kh√°c; H81.1 - Ch√≥ng m·∫∑t k·ªãch ph√°t l√†nh t√≠nh; R42 - Hoa m·∫Øt & ch√≥ng m·∫∑t (ok); M·∫•t ng·ªß cho d·ªÖ ng·ªß"},
            {"Stt": "9.0", "T√™n th∆∞∆°ng m·∫°i": "Rotundin 30", "T√™n, HC, HL": "Rotundin", "Li·ªÅu d√πng": "2v", "M√£ ICD": "G47 - RL gi·∫•c ng·ªß, ƒëau do co th·∫Øt, ƒëau d√¢y TK, ƒëau ƒë·∫ßu do THA & c∆°-x∆∞∆°ng-kh·ªõp, co gi·∫≠t do s·ªët cao"},
            {"Stt": "10.0", "T√™n th∆∞∆°ng m·∫°i": "Methylprednisolon 4", "T√™n, HC, HL": "Methylprednisolon: 4mg", "Li·ªÅu d√πng": "", "M√£ ICD": "Vi√™m da d·ªã ·ª©ng, vi√™m ƒë∆∞·ªùng h√¥ h·∫•p d·ªã ·ª©ng, vi√™m kh·ªõp, th·∫•p kh·ªõp, b·ªánh v·ªÅ m√°u, Thi·∫øu m√°u tan m√°u,Gi·∫£m b·∫°ch c·∫ßu h·∫°t, Trong ƒëi·ªÅu tr·ªã ung th∆∞: leukemia c·∫•p t√≠nh, u lympho, ung th∆∞ v√∫, ung th∆∞ tuy·∫øn ti·ªÅn li·ªát"},
            {"Stt": "11.0", "T√™n th∆∞∆°ng m·∫°i": "cinnarizin", "T√™n, HC, HL": "Cinnarizin 25mg", "Li·ªÅu d√πng": "1-2v x 3", "M√£ ICD": "R42 - Hoa m·∫Øt & ch√≥ng m·∫∑t; H81.3 - Ch√≥ng m·∫∑t do nguy√™n nh√¢n ngo·∫°i bi√™n kh√°c; H81.1 - Ch√≥ng m·∫∑t k·ªãch ph√°t l√†nh t√≠nh; H81 - RL cn ti·ªÅn ƒë√¨nh; H81.0 - B·ªánh M√©ni√®re; Ph√≤ng say t√†u xe 1v <30p; D·ªÖ ng·ªß"},
            {"Stt": "12.0", "T√™n th∆∞∆°ng m·∫°i": "Drotaverin", "T√™n, HC, HL": "Drotaverin clohydrat 40mg", "Li·ªÅu d√πng": "2 x 2", "M√£ ICD": "K58 - HC ru·ªôt k√≠ch th√≠ch; K83.0 - Vi√™m ƒë∆∞·ªùng m·∫≠t; N23 - C∆°n ƒëau qu·∫∑n th·∫≠n KXƒê; K58.0 - HC ru·ªôt k√≠ch th√≠ch, c√≥ ti√™u ch·∫£y; K58.9 - HC ru·ªôt k√≠ch th√≠ch, kh√¥ng ti√™u ch·∫£y; Co th·∫Øt t·ª≠ cung: ƒëau b·ª•ng kinh, d·ªça s·∫©y thai"},
            {"Stt": "13.0", "T√™n th∆∞∆°ng m·∫°i": "Vitamin 3B", "T√™n, HC, HL": "Vitamin B1 + B6 + B12", "Li·ªÅu d√πng": "1 x 2", "M√£ ICD": "M79.2 - ƒêau d√¢y TK & vi√™m d√¢y TK, KƒêH; G58.0 - B·ªánh d√¢y TK li√™n s∆∞·ªùn; G58 - B·ªánh ƒë∆°n d√¢y TK kh√°c; G61 - Vi√™m ƒëa d√¢y TK; G62 - B·ªánh vi√™m ƒëa d√¢y TK kh√°c; G61.9 - B·ªánh vi√™m ƒëa d√¢y TK KƒêH"},
            {"Stt": "14.0", "T√™n th∆∞∆°ng m·∫°i": "Kacerin", "T√™n, HC, HL": "Cetirizin", "Li·ªÅu d√πng": "10mg.", "M√£ ICD": "H10.1 - Vi√™m k·∫øt m·∫°c d·ªã ·ª©ng c·∫•p; J30.3 - Vi√™m m≈©i d·ªã ·ª©ng kh√°c; L50 - M√†y ƒëay"},
            {"Stt": "15.0", "T√™n th∆∞∆°ng m·∫°i": "Captopril 25mg", "T√™n, HC, HL": "Captopril", "Li·ªÅu d√πng": "1 x 2", "M√£ ICD": "I10 - B·ªánh l√Ω THA TƒÉng huy·∫øt √°p kh·ªüi ƒë·∫ßu 25 mg x 2 - 3 l·∫ßn/ng√†y; n·∫∑ng: c√≥ th·ªÉ tƒÉng ƒë·∫øn 50 mg x 3 l·∫ßn/ng√†y. Kh√¥ng qu√° 150 mg/ng√†y. Suy tim ·ª© huy·∫øt n√™n d√πng k√®m l·ª£i ti·ªÉu."}
        ];

        // Online Data Source URL (replace with your actual Excel/JSON URL)
        const ONLINE_DATA_URL = 'https://raw.githubusercontent.com/your-repo/bhyt-data/main/medicine_data.json';
        const EXCEL_DATA_URL = 'https://raw.githubusercontent.com/your-repo/bhyt-data/main/24.ICD10.xlsx';

        // Main App Component
        function App() {
            const [searchTerm, setSearchTerm] = useState('');
            const [medicineData, setMedicineData] = useState([]);
            const [filteredMeds, setFilteredMeds] = useState([]);
            const [favorites, setFavorites] = useState([]);
            const [activeTab, setActiveTab] = useState('all');
            const [selectedMed, setSelectedMed] = useState(null);
            const [showShareModal, setShowShareModal] = useState(false);
            const [showAddModal, setShowAddModal] = useState(false);
            const [showSyncModal, setShowSyncModal] = useState(false);
            const [networkStatus, setNetworkStatus] = useState({
                online: navigator.onLine,
                lastSync: null,
                syncing: false,
                dataSource: 'offline'
            });
            const [userAddedData, setUserAddedData] = useState([]);
            const [syncEnabled, setSyncEnabled] = useState(true);
            const searchInputRef = useRef(null);

            // Initialize
            useEffect(() => {
                loadAllData();
                initializePWA();
                setupNetworkListeners();
                
                if (searchInputRef.current) {
                    setTimeout(() => searchInputRef.current.focus(), 500);
                }
                
                // Try to sync on startup if online
                if (navigator.onLine && syncEnabled) {
                    setTimeout(() => syncOnlineData(), 1000);
                }
            }, []);

            // Network status listeners
            const setupNetworkListeners = () => {
                window.addEventListener('online', () => {
                    setNetworkStatus(prev => ({ ...prev, online: true }));
                    if (syncEnabled) syncOnlineData();
                });
                
                window.addEventListener('offline', () => {
                    setNetworkStatus(prev => ({ ...prev, online: false }));
                });
            };

            // Load all data from localStorage
            const loadAllData = () => {
                // Load favorites
                const savedFavorites = localStorage.getItem(STORAGE_KEYS.FAVORITES);
                if (savedFavorites) {
                    setFavorites(JSON.parse(savedFavorites));
                }
                
                // Load medicine data
                const savedMedicineData = localStorage.getItem(STORAGE_KEYS.MEDICINE_DATA);
                if (savedMedicineData) {
                    const data = JSON.parse(savedMedicineData);
                    setMedicineData(data);
                    setFilteredMeds(data);
                } else {
                    // Use default data
                    setMedicineData(defaultExcelData);
                    setFilteredMeds(defaultExcelData);
                    localStorage.setItem(STORAGE_KEYS.MEDICINE_DATA, JSON.stringify(defaultExcelData));
                }
                
                // Load user added data
                const savedUserData = localStorage.getItem(STORAGE_KEYS.USER_ADDED);
                if (savedUserData) {
                    setUserAddedData(JSON.parse(savedUserData));
                }
                
                // Load last sync
                const lastSync = localStorage.getItem(STORAGE_KEYS.LAST_SYNC);
                setNetworkStatus(prev => ({ ...prev, lastSync }));
                
                // Load sync preference
                const savedSyncPref = localStorage.getItem(STORAGE_KEYS.SYNC_ENABLED);
                if (savedSyncPref !== null) {
                    setSyncEnabled(JSON.parse(savedSyncPref));
                }
            };

            // Save favorites
            useEffect(() => {
                localStorage.setItem(STORAGE_KEYS.FAVORITES, JSON.stringify(favorites));
            }, [favorites]);

            // Save medicine data
            const saveMedicineData = (data) => {
                setMedicineData(data);
                localStorage.setItem(STORAGE_KEYS.MEDICINE_DATA, JSON.stringify(data));
            };

            // Save user added data
            const saveUserAddedData = (data) => {
                setUserAddedData(data);
                localStorage.setItem(STORAGE_KEYS.USER_ADDED, JSON.stringify(data));
            };

            // Filter medicines
            useEffect(() => {
                if (!searchTerm.trim()) {
                    setFilteredMeds(medicineData);
                    return;
                }
                
                const term = searchTerm.toLowerCase().trim();
                const results = medicineData.filter(med => {
                    return (
                        (med['T√™n th∆∞∆°ng m·∫°i'] && med['T√™n th∆∞∆°ng m·∫°i'].toLowerCase().includes(term)) ||
                        (med['T√™n, HC, HL'] && med['T√™n, HC, HL'].toLowerCase().includes(term)) ||
                        (med['M√£ ICD'] && med['M√£ ICD'].toLowerCase().includes(term)) ||
                        (med['Li·ªÅu d√πng'] && med['Li·ªÅu d√πng'].toLowerCase().includes(term))
                    );
                });
                setFilteredMeds(results);
            }, [searchTerm, medicineData]);

            // Sync with online data
            const syncOnlineData = async () => {
                if (!networkStatus.online || !syncEnabled) return;
                
                setNetworkStatus(prev => ({ ...prev, syncing: true }));
                
                try {
                    // Try to fetch JSON data first
                    const response = await fetch(ONLINE_DATA_URL + '?t=' + Date.now());
                    if (!response.ok) throw new Error('Failed to fetch online data');
                    
                    const onlineData = await response.json();
                    
                    if (onlineData && Array.isArray(onlineData) && onlineData.length > 0) {
                        // Merge with local data
                        const mergedData = mergeMedicineData(medicineData, onlineData);
                        saveMedicineData(mergedData);
                        
                        // Update sync status
                        const now = new Date().toISOString();
                        localStorage.setItem(STORAGE_KEYS.LAST_SYNC, now);
                        setNetworkStatus(prev => ({ 
                            ...prev, 
                            lastSync: now,
                            dataSource: 'online',
                            syncing: false 
                        }));
                        
                        return { success: true, count: onlineData.length };
                    }
                } catch (error) {
                    console.log('Online sync failed:', error);
                    
                    // Try to fetch Excel file
                    try {
                        const excelResponse = await fetch(EXCEL_DATA_URL + '?t=' + Date.now());
                        if (!excelResponse.ok) throw new Error('Failed to fetch Excel');
                        
                        const arrayBuffer = await excelResponse.arrayBuffer();
                        const workbook = XLSX.read(arrayBuffer, { type: 'array' });
                        const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                        const excelData = XLSX.utils.sheet_to_json(worksheet);
                        
                        if (excelData && excelData.length > 0) {
                            const mergedData = mergeMedicineData(medicineData, excelData);
                            saveMedicineData(mergedData);
                            
                            const now = new Date().toISOString();
                            localStorage.setItem(STORAGE_KEYS.LAST_SYNC, now);
                            setNetworkStatus(prev => ({ 
                                ...prev, 
                                lastSync: now,
                                dataSource: 'excel',
                                syncing: false 
                            }));
                            
                            return { success: true, count: excelData.length };
                        }
                    } catch (excelError) {
                        console.log('Excel sync also failed:', excelError);
                    }
                }
                
                setNetworkStatus(prev => ({ ...prev, syncing: false }));
                return { success: false, count: 0 };
            };

            // Merge data with priority
            const mergeMedicineData = (localData, newData) => {
                const localMap = new Map();
                localData.forEach(item => {
                    const key = item['Stt'] || item['T√™n th∆∞∆°ng m·∫°i'];
                    if (key) localMap.set(key, item);
                });
                
                newData.forEach(item => {
                    const key = item['Stt'] || item['T√™n th∆∞∆°ng m·∫°i'];
                    if (key && !localMap.has(key)) {
                        localMap.set(key, item);
                    }
                });
                
                return Array.from(localMap.values());
            };

            // Toggle favorite
            const toggleFavorite = (medId) => {
                if (favorites.includes(medId)) {
                    setFavorites(favorites.filter(id => id !== medId));
                } else {
                    setFavorites([...favorites, medId]);
                }
            };

            // Add new medicine
            const addNewMedicine = () => {
                const name = document.getElementById('new-med-name').value;
                const generic = document.getElementById('new-med-generic').value;
                const dosage = document.getElementById('new-med-dosage').value;
                const icd = document.getElementById('new-med-icd').value;
                
                if (!name) {
                    alert('Vui l√≤ng nh·∫≠p t√™n thu·ªëc');
                    return;
                }
                
                const newMed = {
                    'Stt': `U${userAddedData.length + 1}.0`,
                    'T√™n th∆∞∆°ng m·∫°i': name,
                    'T√™n, HC, HL': generic,
                    'Li·ªÅu d√πng': dosage,
                    'M√£ ICD': icd,
                    'userAdded': true
                };
                
                const updatedData = [...medicineData, newMed];
                saveMedicineData(updatedData);
                
                const updatedUserData = [...userAddedData, newMed];
                saveUserAddedData(updatedUserData);
                
                // Clear form
                document.getElementById('new-med-name').value = '';
                document.getElementById('new-med-generic').value = '';
                document.getElementById('new-med-dosage').value = '';
                document.getElementById('new-med-icd').value = '';
                
                setShowAddModal(false);
                alert('ƒê√£ th√™m thu·ªëc m·ªõi th√†nh c√¥ng!');
            };

            // Export data
            const exportData = () => {
                const dataToExport = {
                    medicineData,
                    userAddedData,
                    favorites,
                    lastSync: networkStatus.lastSync,
                    exportedAt: new Date().toISOString()
                };
                
                const blob = new Blob([JSON.stringify(dataToExport, null, 2)], { 
                    type: 'application/json' 
                });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `bhyt_data_backup_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            };

            // Import data
            const importData = (event) => {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        
                        if (importedData.medicineData) {
                            saveMedicineData(importedData.medicineData);
                        }
                        
                        if (importedData.userAddedData) {
                            saveUserAddedData(importedData.userAddedData);
                        }
                        
                        if (importedData.favorites) {
                            setFavorites(importedData.favorites);
                        }
                        
                        alert('Import d·ªØ li·ªáu th√†nh c√¥ng!');
                    } catch (error) {
                        alert('L·ªói khi import d·ªØ li·ªáu: ' + error.message);
                    }
                };
                reader.readAsText(file);
            };

            // PWA initialization
            const initializePWA = () => {
                // Dynamic Manifest
                const manifest = {
                    name: "BHYT Pharma Tracker",
                    short_name: "BHYT Rx",
                    description: "Tra c·ª©u thu·ªëc BHYT - H·ªó tr·ª£ b√°c sƒ© k√™ ƒë∆°n",
                    start_url: ".",
                    display: "standalone",
                    background_color: "#f0f7ff",
                    theme_color: "#3b82f6",
                    icons: [
                        {
                            src: "https://img.icons8.com/color/96/000000/medical-doctor.png",
                            sizes: "96x96",
                            type: "image/png"
                        }
                    ]
                };
                
                const manifestBlob = new Blob([JSON.stringify(manifest)], { type: 'application/json' });
                const manifestURL = URL.createObjectURL(manifestBlob);
                
                const link = document.createElement('link');
                link.rel = 'manifest';
                link.href = manifestURL;
                document.head.appendChild(link);
                
                // Service Worker
                if ('serviceWorker' in navigator) {
                    const swCode = `
                        self.addEventListener('install', (event) => {
                            self.skipWaiting();
                            console.log('Service Worker installed');
                        });
                        
                        self.addEventListener('fetch', (event) => {
                            event.respondWith(
                                caches.match(event.request).then(response => {
                                    return response || fetch(event.request);
                                })
                            );
                        });
                    `;
                    
                    const swBlob = new Blob([swCode], { type: 'application/javascript' });
                    const swURL = URL.createObjectURL(swBlob);
                    
                    navigator.serviceWorker.register(swURL)
                        .then(reg => console.log('Service Worker registered:', reg))
                        .catch(err => console.log('Service Worker failed:', err));
                }
            };

            // Share as APK
            const shareAsAPK = () => {
                const appHtml = document.documentElement.outerHTML;
                const blob = new Blob([appHtml], { type: 'application/vnd.android.package-archive' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = 'BHYT_Pharma_Tracker.apk';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                setShowShareModal(true);
                setTimeout(() => setShowShareModal(false), 3000);
            };

            // Highlight search term
            const highlightText = (text) => {
                if (!searchTerm.trim() || !text) return text;
                
                const regex = new RegExp(`(${searchTerm.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
                const parts = String(text).split(regex);
                
                return parts.map((part, i) => 
                    regex.test(part) ? 
                    React.createElement('span', { key: i, className: 'search-highlight' }, part) : 
                    part
                );
            };

            // Format date
            const formatDate = (dateString) => {
                if (!dateString) return 'Ch∆∞a ƒë·ªìng b·ªô';
                const date = new Date(dateString);
                return date.toLocaleDateString('vi-VN', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            };

            // Get display medicines based on active tab
            const getDisplayMeds = () => {
                let meds = filteredMeds;
                
                if (activeTab === 'favorites') {
                    meds = meds.filter(med => favorites.includes(med.Stt));
                } else if (activeTab === 'user') {
                    meds = meds.filter(med => med.userAdded);
                }
                
                return meds;
            };

            // Stats
            const stats = {
                total: medicineData.length,
                favorites: favorites.length,
                userAdded: userAddedData.length,
                filtered: getDisplayMeds().length,
                online: networkStatus.online
            };

            return React.createElement('div', { className: 'min-h-screen pb-24' },
                // Header
                React.createElement('header', { className: 'bg-gradient-to-r from-blue-700 to-blue-900 text-white shadow-xl' },
                    React.createElement('div', { className: 'container mx-auto p-4' },
                        // Network Status Bar
                        React.createElement('div', { className: 'flex justify-between items-center mb-4 text-sm' },
                            React.createElement('div', { className: 'flex items-center space-x-2' },
                                React.createElement('span', { 
                                    className: `network-indicator ${networkStatus.online ? 'network-online' : 'network-offline'}` 
                                }),
                                React.createElement('span', null, networkStatus.online ? 'ƒêang tr·ª±c tuy·∫øn' : 'Ngo·∫°i tuy·∫øn')
                            ),
                            React.createElement('div', { className: 'flex items-center space-x-3' },
                                networkStatus.syncing && React.createElement('div', { className: 'flex items-center text-yellow-300' },
                                    React.createElement(LucideIcons.Refresh, { className: 'animate-spin mr-1' }),
                                    React.createElement('span', null, 'ƒê·ªìng b·ªô...')
                                ),
                                React.createElement('button', {
                                    onClick: () => networkStatus.online && syncOnlineData(),
                                    className: `p-1 rounded ${networkStatus.online ? 'hover:bg-blue-600' : 'opacity-50 cursor-not-allowed'}`,
                                    disabled: !networkStatus.online
                                },
                                    React.createElement(LucideIcons.Refresh, { 
                                        className: networkStatus.syncing ? 'animate-spin' : '' 
                                    })
                                )
                            )
                        ),
                        
                        // App Title
                        React.createElement('div', { className: 'flex justify-between items-center mb-4' },
                            React.createElement('div', { className: 'flex items-center space-x-3' },
                                React.createElement('div', { className: 'bg-white p-2 rounded-full shadow-md' },
                                    React.createElement(LucideIcons.User, { className: 'text-blue-700 text-xl' })
                                ),
                                React.createElement('div', null,
                                    React.createElement('h1', { className: 'text-xl font-bold' }, 'BHYT Pharma Tracker'),
                                    React.createElement('p', { className: 'text-blue-200 text-sm' }, 'Tra c·ª©u thu·ªëc - ƒê·ªìng b·ªô ƒëa n·ªÅn t·∫£ng')
                                )
                            ),
                            React.createElement('button', {
                                onClick: shareAsAPK,
                                className: 'bg-white text-blue-700 p-2 rounded-full shadow-lg hover:bg-blue-50 transition'
                            },
                                React.createElement(LucideIcons.Share2, { className: 'text-lg' })
                            )
                        ),
                        
                        // Search Bar
                        React.createElement('div', { className: 'relative' },
                            React.createElement('div', { className: 'absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400' },
                                React.createElement(LucideIcons.Search, null)
                            ),
                            React.createElement('input', {
                                ref: searchInputRef,
                                type: 'text',
                                placeholder: 'üîç T√¨m t√™n thu·ªëc, ho·∫°t ch·∫•t, ICD-10...',
                                className: 'w-full pl-10 pr-4 py-3 rounded-full text-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500 shadow-inner',
                                value: searchTerm,
                                onChange: (e) => setSearchTerm(e.target.value)
                            }),
                            searchTerm && React.createElement('button', {
                                onClick: () => setSearchTerm(''),
                                className: 'absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600'
                            },
                                React.createElement(LucideIcons.X, null)
                            )
                        )
                    )
                ),

                // Stats Cards
                React.createElement('div', { className: 'container mx-auto px-4 -mt-2' },
                    React.createElement('div', { className: 'grid grid-cols-2 md:grid-cols-4 gap-3' },
                        // Total Medicines
                        React.createElement('div', { className: 'bg-white rounded-xl shadow p-3' },
                            React.createElement('div', { className: 'flex items-center justify-between' },
                                React.createElement('div', null,
                                    React.createElement('p', { className: 'text-2xl font-bold text-blue-600' }, stats.total),
                                    React.createElement('p', { className: 'text-xs text-gray-500' }, 'T·ªïng thu·ªëc')
                                ),
                                React.createElement(LucideIcons.Pill, { className: 'text-blue-400' })
                            )
                        ),
                        
                        // Favorites
                        React.createElement('div', { className: 'bg-white rounded-xl shadow p-3' },
                            React.createElement('div', { className: 'flex items-center justify-between' },
                                React.createElement('div', null,
                                    React.createElement('p', { className: 'text-2xl font-bold text-yellow-600' }, stats.favorites),
                                    React.createElement('p', { className: 'text-xs text-gray-500' }, 'ƒê√£ l∆∞u')
                                ),
                                React.createElement(LucideIcons.Star, { className: 'text-yellow-400' })
                            )
                        ),
                        
                        // User Added
                        React.createElement('div', { className: 'bg-white rounded-xl shadow p-3' },
                            React.createElement('div', { className: 'flex items-center justify-between' },
                                React.createElement('div', null,
                                    React.createElement('p', { className: 'text-2xl font-bold text-green-600' }, stats.userAdded),
                                    React.createElement('p', { className: 'text-xs text-gray-500' }, 'ƒê√£ th√™m')
                                ),
                                React.createElement(LucideIcons.Upload, { className: 'text-green-400' })
                            )
                        ),
                        
                        // Network Status
                        React.createElement('div', { className: 'bg-white rounded-xl shadow p-3' },
                            React.createElement('div', { className: 'flex items-center justify-between' },
                                React.createElement('div', null,
                                    React.createElement('p', { className: 'text-2xl font-bold', 
                                        className: stats.online ? 'text-green-600' : 'text-gray-600' 
                                    }, stats.online ? 'Online' : 'Offline'),
                                    React.createElement('p', { className: 'text-xs text-gray-500' }, 'Tr·∫°ng th√°i')
                                ),
                                stats.online ? 
                                    React.createElement(LucideIcons.Wifi, { className: 'text-green-400' }) :
                                    React.createElement(LucideIcons.WifiOff, { className: 'text-gray-400' })
                            )
                        )
                    )
                ),

                // Tabs
                React.createElement('div', { className: 'bg-white border-b shadow-sm mt-4 sticky top-0 z-10' },
                    React.createElement('div', { className: 'container mx-auto flex overflow-x-auto scrollbar-hide' },
                        ['all', 'favorites', 'user'].map(tab => ({
                            id: tab,
                            label: tab === 'all' ? 'T·∫•t c·∫£' : tab === 'favorites' ? 'ƒê√£ l∆∞u' : 'ƒê√£ th√™m',
                            icon: tab === 'all' ? LucideIcons.Pill : tab === 'favorites' ? LucideIcons.Star : LucideIcons.Upload
                        })).map(tab => 
                            React.createElement('button', {
                                key: tab.id,
                                className: `flex-shrink-0 px-4 py-3 text-sm font-medium flex items-center space-x-2 ${activeTab === tab.id ? 'text-blue-600 border-b-2 border-blue-600' : 'text-gray-500'}`,
                                onClick: () => setActiveTab(tab.id)
                            },
                                React.createElement(tab.icon, { className: 'text-sm' }),
                                React.createElement('span', null, tab.label)
                            )
                        )
                    )
                ),

                // Main Content
                React.createElement('main', { className: 'container mx-auto p-4' },
                    // Selected Medicine Detail
                    selectedMed && React.createElement('div', { className: 'mb-6 animate-fadeIn' },
                        React.createElement('div', { className: 'bg-white rounded-2xl shadow-xl p-6 border border-blue-100' },
                            React.createElement('div', { className: 'flex justify-between items-start mb-6' },
                                React.createElement('div', null,
                                    React.createElement('h2', { className: 'text-2xl font-bold text-blue-900' }, selectedMed['T√™n th∆∞∆°ng m·∫°i']),
                                    selectedMed.userAdded && React.createElement('span', { className: 'inline-block bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full mt-1' },
                                        'ƒê√£ th√™m th·ªß c√¥ng'
                                    )
                                ),
                                React.createElement('div', { className: 'flex space-x-2' },
                                    React.createElement('button', {
                                        onClick: () => toggleFavorite(selectedMed.Stt),
                                        className: `p-2 rounded-full ${favorites.includes(selectedMed.Stt) ? 'bg-yellow-100 text-yellow-600' : 'bg-gray-100 text-gray-400'} hover:bg-yellow-50 transition`
                                    },
                                        React.createElement(LucideIcons.Star, { className: favorites.includes(selectedMed.Stt) ? 'fill-current' : '' })
                                    ),
                                    React.createElement('button', {
                                        onClick: () => setSelectedMed(null),
                                        className: 'p-2 rounded-full bg-gray-100 text-gray-600 hover:bg-gray-200 transition'
                                    },
                                        React.createElement(LucideIcons.X, null)
                                    )
                                )
                            ),
                            
                            // Medicine Details
                            React.createElement('div', { className: 'space-y-5' },
                                // Generic Name
                                React.createElement('div', null,
                                    React.createElement('div', { className: 'flex items-center text-gray-700 mb-2' },
                                        React.createElement('div', { className: 'w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center mr-3' },
                                            React.createElement(LucideIcons.Pill, { className: 'text-blue-600 text-sm' })
                                        ),
                                        React.createElement('h3', { className: 'font-semibold' }, 'Ho·∫°t ch·∫•t')
                                    ),
                                    React.createElement('p', { className: 'text-gray-900 text-lg pl-9' }, selectedMed['T√™n, HC, HL'] || 'Ch∆∞a c√≥ th√¥ng tin')
                                ),
                                
                                // Dosage
                                React.createElement('div', null,
                                    React.createElement('div', { className: 'flex items-center text-gray-700 mb-2' },
                                        React.createElement('div', { className: 'w-6 h-6 bg-green-100 rounded-full flex items-center justify-center mr-3' },
                                            React.createElement(LucideIcons.Calendar, { className: 'text-green-600 text-sm' })
                                        ),
                                        React.createElement('h3', { className: 'font-semibold' }, 'Li·ªÅu d√πng')
                                    ),
                                    React.createElement('p', { className: 'text-gray-900 text-lg pl-9 font-bold text-green-700' }, selectedMed['Li·ªÅu d√πng'] || 'Ch∆∞a c√≥ th√¥ng tin')
                                ),
                                
                                // ICD Codes
                                React.createElement('div', null,
                                    React.createElement('div', { className: 'flex items-center text-gray-700 mb-2' },
                                        React.createElement('div', { className: 'w-6 h-6 bg-purple-100 rounded-full flex items-center justify-center mr-3' },
                                            React.createElement(LucideIcons.FileText, { className: 'text-purple-600 text-sm' })
                                        ),
                                        React.createElement('h3', { className: 'font-semibold' }, 'M√£ ICD-10')
                                    ),
                                    React.createElement('div', { className: 'pl-9' },
                                        selectedMed['M√£ ICD'] ? selectedMed['M√£ ICD'].split(';').map((code, idx) => 
                                            React.createElement('div', { key: idx, className: 'mb-1' },
                                                React.createElement('span', { className: 'bg-purple-50 text-purple-800 px-3 py-1 rounded-full text-sm inline-block' }, 
                                                    code.trim()
                                                )
                                            )
                                        ) : React.createElement('p', { className: 'text-gray-900' }, 'Ch∆∞a c√≥ th√¥ng tin')
                                    )
                                ),
                                
                                // BHYT Notes
                                React.createElement('div', null,
                                    React.createElement('div', { className: 'flex items-center text-gray-700 mb-2' },
                                        React.createElement('div', { className: 'w-6 h-6 bg-red-100 rounded-full flex items-center justify-center mr-3' },
                                            React.createElement(LucideIcons.AlertTriangle, { className: 'text-red-600 text-sm' })
                                        ),
                                        React.createElement('h3', { className: 'font-semibold' }, 'L∆∞u √Ω BHYT')
                                    ),
                                    React.createElement('div', { className: 'bg-red-50 border border-red-100 rounded-xl p-4 pl-9' },
                                        React.createElement('ul', { className: 'space-y-2 text-sm text-gray-700' },
                                            React.createElement('li', { className: 'flex items-start' },
                                                React.createElement('span', { className: 'text-red-500 mr-2' }, '‚Ä¢'),
                                                'Ki·ªÉm tra thu·ªëc trong danh m·ª•c BHYT tr∆∞·ªõc khi k√™ ƒë∆°n'
                                            ),
                                            React.createElement('li', { className: 'flex items-start' },
                                                React.createElement('span', { className: 'text-red-500 mr-2' }, '‚Ä¢'),
                                                'Ch·ªçn ƒë√∫ng m√£ ICD-10 ph√π h·ª£p v·ªõi ch·ªâ ƒë·ªãnh thu·ªëc'
                                            ),
                                            React.createElement('li', { className: 'flex items-start' },
                                                React.createElement('span', { className: 'text-red-500 mr-2' }, '‚Ä¢'),
                                                'Tr√°nh k√™ c√°c thu·ªëc c√≥ t√°c d·ª•ng ƒë·ªëi ngh·ªãch nhau'
                                            )
                                        )
                                    )
                                )
                            )
                        )
                    ),

                    // Medicine List
                    React.createElement('div', null,
                        React.createElement('div', { className: 'flex justify-between items-center mb-4' },
                            React.createElement('h3', { className: 'text-lg font-semibold text-gray-800' },
                                `${getDisplayMeds().length} k·∫øt qu·∫£ ${searchTerm ? `cho "${searchTerm}"` : ''}`
                            ),
                            React.createElement('div', { className: 'text-sm text-gray-500 flex items-center' },
                                React.createElement(LucideIcons.Database, { className: 'mr-1 text-blue-500' }),
                                `Ngu·ªìn: ${networkStatus.dataSource}`
                            )
                        ),
                        
                        getDisplayMeds().length === 0 ? 
                            React.createElement('div', { className: 'text-center py-12' },
                                React.createElement('div', { className: 'text-gray-300 text-6xl mb-4' },
                                    React.createElement(LucideIcons.Search, null)
                                ),
                                React.createElement('p', { className: 'text-gray-500 text-lg mb-2' }, 
                                    searchTerm ? 'Kh√¥ng t√¨m th·∫•y thu·ªëc ph√π h·ª£p' : 'Kh√¥ng c√≥ thu·ªëc n√†o'
                                ),
                                !searchTerm && React.createElement('button', {
                                    onClick: () => setShowAddModal(true),
                                    className: 'mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition'
                                },
                                    React.createElement(LucideIcons.Plus, { className: 'inline mr-2' }),
                                    'Th√™m thu·ªëc m·ªõi'
                                )
                            ) :
                            React.createElement('div', { className: 'grid gap-4' },
                                getDisplayMeds().map((med, index) => {
                                    const isFavorite = favorites.includes(med.Stt);
                                    const isUserAdded = med.userAdded;
                                    const categoryColor = isUserAdded ? 'from-green-400 to-green-600' : 
                                                        med.Stt.includes('.0') ? 'from-blue-400 to-blue-600' : 'from-purple-400 to-purple-600';
                                    
                                    return React.createElement('div', {
                                        key: med.Stt + index,
                                        className: 'bg-white rounded-xl shadow card-hover border border-gray-100 cursor-pointer',
                                        onClick: () => setSelectedMed(med)
                                    },
                                        React.createElement('div', { className: 'p-4' },
                                            // Header with badge
                                            React.createElement('div', { className: 'flex justify-between items-start mb-3' },
                                                React.createElement('div', { className: 'flex-1' },
                                                    React.createElement('div', { className: 'flex items-center mb-1' },
                                                        React.createElement('span', { 
                                                            className: `text-xs text-white font-bold px-2 py-1 rounded-full bg-gradient-to-r ${categoryColor}`
                                                        }, med.Stt),
                                                        isUserAdded && React.createElement('span', { 
                                                            className: 'ml-2 text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full'
                                                        }, 'Th√™m th·ªß c√¥ng')
                                                    ),
                                                    React.createElement('h4', { className: 'font-bold text-gray-900 text-lg' }, 
                                                        highlightText(med['T√™n th∆∞∆°ng m·∫°i'])
                                                    ),
                                                    med['T√™n, HC, HL'] && React.createElement('p', { className: 'text-gray-600 text-sm mt-1' }, 
                                                        highlightText(med['T√™n, HC, HL'])
                                                    )
                                                ),
                                                React.createElement('button', {
                                                    onClick: (e) => {
                                                        e.stopPropagation();
                                                        toggleFavorite(med.Stt);
                                                    },
                                                    className: `text-xl ${isFavorite ? 'text-yellow-500 hover:text-yellow-600' : 'text-gray-300 hover:text-yellow-400'} transition`
                                                },
                                                    React.createElement(LucideIcons.Star, { className: isFavorite ? 'fill-current' : '' })
                                                )
                                            ),
                                            
                                            // Dosage and ICD
                                            React.createElement('div', { className: 'grid grid-cols-2 gap-3 mt-4' },
                                                React.createElement('div', null,
                                                    React.createElement('div', { className: 'flex items-center text-gray-500 mb-1' },
                                                        React.createElement(LucideIcons.Calendar, { className: 'text-green-500 mr-2 text-sm' }),
                                                        React.createElement('span', { className: 'text-xs font-medium' }, 'Li·ªÅu d√πng')
                                                    ),
                                                    React.createElement('p', { className: 'text-gray-800 font-semibold' }, 
                                                        med['Li·ªÅu d√πng'] || 'Kh√¥ng c√≥'
                                                    )
                                                ),
                                                React.createElement('div', null,
                                                    React.createElement('div', { className: 'flex items-center text-gray-500 mb-1' },
                                                        React.createElement(LucideIcons.FileText, { className: 'text-purple-500 mr-2 text-sm' }),
                                                        React.createElement('span', { className: 'text-xs font-medium' }, 'ICD-10')
                                                    ),
                                                    React.createElement('p', { className: 'text-gray-800 line-clamp-1' }, 
                                                        med['M√£ ICD'] ? med['M√£ ICD'].split(';')[0].trim() : 'Kh√¥ng c√≥'
                                                    )
                                                )
                                            )
                                        )
                                    );
                                })
                            )
                    )
                ),

                // Action Buttons (Floating)
                React.createElement('div', { className: 'fixed bottom-20 right-4 z-20 flex flex-col space-y-3' },
                    // Add Medicine Button
                    React.createElement('button', {
                        onClick: () => setShowAddModal(true),
                        className: 'bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-full shadow-xl hover:shadow-2xl transition-all hover:scale-105'
                    },
                        React.createElement(LucideIcons.Plus, { className: 'text-xl' })
                    ),
                    
                    // Sync Button
                    React.createElement('button', {
                        onClick: () => syncOnlineData(),
                        disabled: !networkStatus.online || networkStatus.syncing,
                        className: `p-4 rounded-full shadow-xl hover:shadow-2xl transition-all hover:scale-105 ${networkStatus.online ? 'bg-gradient-to-r from-blue-500 to-blue-600 text-white' : 'bg-gray-400 text-gray-200 cursor-not-allowed'}`
                    },
                        networkStatus.syncing ? 
                            React.createElement(LucideIcons.Refresh, { className: 'text-xl animate-spin' }) :
                            React.createElement(LucideIcons.Cloud, { className: 'text-xl' })
                    ),
                    
                    // Data Management Button
                    React.createElement('button', {
                        onClick: () => setShowSyncModal(true),
                        className: 'bg-gradient-to-r from-purple-500 to-purple-600 text-white p-4 rounded-full shadow-xl hover:shadow-2xl transition-all hover:scale-105'
                    },
                        React.createElement(LucideIcons.Database, { className: 'text-xl' })
                    )
                ),

                // Bottom Navigation
                React.createElement('nav', { className: 'fixed bottom-0 left-0 right-0 bg-white border-t shadow-lg py-3 px-6 z-10' },
                    React.createElement('div', { className: 'flex justify-between items-center' },
                        React.createElement('button', {
                            className: `flex flex-col items-center ${activeTab === 'all' ? 'text-blue-600' : 'text-gray-500'}`,
                            onClick: () => setActiveTab('all')
                        },
                            React.createElement(LucideIcons.Pill, { className: 'text-xl mb-1' }),
                            React.createElement('span', { className: 'text-xs' }, 'T·∫•t c·∫£')
                        ),
                        
                        React.createElement('button', {
                            className: `flex flex-col items-center ${activeTab === 'favorites' ? 'text-blue-600' : 'text-gray-500'}`,
                            onClick: () => setActiveTab('favorites')
                        },
                            React.createElement(LucideIcons.Star, { className: 'text-xl mb-1' }),
                            React.createElement('span', { className: 'text-xs' }, 'ƒê√£ l∆∞u')
                        ),
                        
                        React.createElement('button', {
                            className: `flex flex-col items-center ${activeTab === 'user' ? 'text-blue-600' : 'text-gray-500'}`,
                            onClick: () => setActiveTab('user')
                        },
                            React.createElement(LucideIcons.Upload, { className: 'text-xl mb-1' }),
                            React.createElement('span', { className: 'text-xs' }, 'ƒê√£ th√™m')
                        ),
                        
                        React.createElement('button', {
                            className: 'flex flex-col items-center text-gray-500',
                            onClick: () => setShowSyncModal(true)
                        },
                            React.createElement(LucideIcons.History, { className: 'text-xl mb-1' }),
                            React.createElement('span', { className: 'text-xs' }, 'Qu·∫£n l√Ω')
                        )
                    )
                ),

                // Add Medicine Modal
                showAddModal && React.createElement('div', { className: 'fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-60 p-4' },
                    React.createElement('div', { className: 'bg-white rounded-2xl p-6 max-w-md w-full shadow-2xl' },
                        React.createElement('div', { className: 'flex justify-between items-center mb-6' },
                            React.createElement('h3', { className: 'text-xl font-bold text-gray-800' }, 'Th√™m thu·ªëc m·ªõi'),
                            React.createElement('button', {
                                onClick: () => setShowAddModal(false),
                                className: 'text-gray-400 hover:text-gray-600'
                            },
                                React.createElement(LucideIcons.X, null)
                            )
                        ),
                        
                        React.createElement('div', { className: 'space-y-4' },
                            React.createElement('div', null,
                                React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-1' }, 'T√™n th∆∞∆°ng m·∫°i *'),
                                React.createElement('input', {
                                    id: 'new-med-name',
                                    type: 'text',
                                    className: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500',
                                    placeholder: 'V√≠ d·ª•: Panadol Extra'
                                })
                            ),
                            
                            React.createElement('div', null,
                                React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-1' }, 'Ho·∫°t ch·∫•t'),
                                React.createElement('input', {
                                    id: 'new-med-generic',
                                    type: 'text',
                                    className: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500',
                                    placeholder: 'V√≠ d·ª•: Paracetamol 500mg'
                                })
                            ),
                            
                            React.createElement('div', null,
                                React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-1' }, 'Li·ªÅu d√πng'),
                                React.createElement('input', {
                                    id: 'new-med-dosage',
                                    type: 'text',
                                    className: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500',
                                    placeholder: 'V√≠ d·ª•: 1 vi√™n x 3 l·∫ßn/ng√†y'
                                })
                            ),
                            
                            React.createElement('div', null,
                                React.createElement('label', { className: 'block text-sm font-medium text-gray-700 mb-1' }, 'M√£ ICD-10'),
                                React.createElement('input', {
                                    id: 'new-med-icd',
                                    type: 'text',
                                    className: 'w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500',
                                    placeholder: 'V√≠ d·ª•: R51 - ƒêau ƒë·∫ßu; J00 - C·∫£m c√∫m'
                                })
                            )
                        ),
                        
                        React.createElement('div', { className: 'flex space-x-3 mt-6' },
                            React.createElement('button', {
                                onClick: () => setShowAddModal(false),
                                className: 'flex-1 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition font-medium'
                            }, 'H·ªßy'),
                            React.createElement('button', {
                                onClick: addNewMedicine,
                                className: 'flex-1 py-3 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg hover:from-green-600 hover:to-green-700 transition font-medium'
                            }, 'Th√™m thu·ªëc')
                        )
                    )
                ),

                // Sync & Data Management Modal
                showSyncModal && React.createElement('div', { className: 'fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-60 p-4' },
                    React.createElement('div', { className: 'bg-white rounded-2xl p-6 max-w-md w-full shadow-2xl' },
                        React.createElement('div', { className: 'flex justify-between items-center mb-6' },
                            React.createElement('h3', { className: 'text-xl font-bold text-gray-800' }, 'Qu·∫£n l√Ω d·ªØ li·ªáu'),
                            React.createElement('button', {
                                onClick: () => setShowSyncModal(false),
                                className: 'text-gray-400 hover:text-gray-600'
                            },
                                React.createElement(LucideIcons.X, null)
                            )
                        ),
                        
                        // Sync Status
                        React.createElement('div', { className: 'bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-4 mb-6' },
                            React.createElement('div', { className: 'flex items-center justify-between mb-3' },
                                React.createElement('div', { className: 'flex items-center' },
                                    React.createElement(LucideIcons.NetworkWired, { className: 'text-blue-600 mr-2' }),
                                    React.createElement('h4', { className: 'font-semibold text-gray-800' }, 'Tr·∫°ng th√°i ƒë·ªìng b·ªô')
                                ),
                                React.createElement('div', { className: 'flex items-center' },
                                    React.createElement('span', { 
                                        className: `network-indicator mr-2 ${networkStatus.online ? 'network-online' : 'network-offline'}` 
                                    }),
                                    React.createElement('span', { 
                                        className: `text-sm font-medium ${networkStatus.online ? 'text-green-600' : 'text-gray-600'}` 
                                    }, networkStatus.online ? 'Online' : 'Offline')
                                )
                            ),
                            
                            React.createElement('div', { className: 'text-sm text-gray-600 space-y-1' },
                                React.createElement('div', { className: 'flex justify-between' },
                                    React.createElement('span', null, 'Ngu·ªìn d·ªØ li·ªáu:'),
                                    React.createElement('span', { className: 'font-medium' }, networkStatus.dataSource)
                                ),
                                React.createElement('div', { className: 'flex justify-between' },
                                    React.createElement('span', null, 'L·∫ßn cu·ªëi ƒë·ªìng b·ªô:'),
                                    React.createElement('span', { className: 'font-medium' }, formatDate(networkStatus.lastSync))
                                ),
                                React.createElement('div', { className: 'flex justify-between' },
                                    React.createElement('span', null, 'T·ªïng s·ªë thu·ªëc:'),
                                    React.createElement('span', { className: 'font-medium' }, stats.total)
                                )
                            )
                        ),
                        
                        // Sync Settings
                        React.createElement('div', { className: 'mb-6' },
                            React.createElement('h4', { className: 'font-semibold text-gray-800 mb-3' }, 'C√†i ƒë·∫∑t ƒë·ªìng b·ªô'),
                            React.createElement('div', { className: 'flex items-center justify-between p-3 bg-gray-50 rounded-lg' },
                                React.createElement('div', null,
                                    React.createElement('div', { className: 'font-medium text-gray-800' }, 'T·ª± ƒë·ªông ƒë·ªìng b·ªô'),
                                    React.createElement('div', { className: 'text-sm text-gray-600' }, 'C·∫≠p nh·∫≠t d·ªØ li·ªáu khi tr·ª±c tuy·∫øn')
                                ),
                                React.createElement('button', {
                                    onClick: () => {
                                        const newValue = !syncEnabled;
                                        setSyncEnabled(newValue);
                                        localStorage.setItem(STORAGE_KEYS.SYNC_ENABLED, JSON.stringify(newValue));
                                    },
                                    className: `relative inline-flex h-6 w-11 items-center rounded-full ${syncEnabled ? 'bg-blue-600' : 'bg-gray-300'} transition-colors`
                                },
                                    React.createElement('span', { 
                                        className: `inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${syncEnabled ? 'translate-x-6' : 'translate-x-1'}` 
                                    })
                                )
                            )
                        ),
                        
                        // Data Actions
                        React.createElement('div', { className: 'grid gap-3' },
                            React.createElement('button', {
                                onClick: exportData,
                                className: 'flex items-center justify-center p-3 bg-gradient-to-r from-green-50 to-green-100 text-green-700 rounded-lg hover:from-green-100 hover:to-green-200 transition border border-green-200'
                            },
                                React.createElement(LucideIcons.Download, { className: 'mr-2' }),
                                'Export d·ªØ li·ªáu'
                            ),
                            
                            React.createElement('label', {
                                className: 'flex items-center justify-center p-3 bg-gradient-to-r from-blue-50 to-blue-100 text-blue-700 rounded-lg hover:from-blue-100 hover:to-blue-200 transition border border-blue-200 cursor-pointer'
                            },
                                React.createElement(LucideIcons.Upload, { className: 'mr-2' }),
                                'Import d·ªØ li·ªáu',
                                React.createElement('input', {
                                    type: 'file',
                                    accept: '.json',
                                    onChange: importData,
                                    className: 'hidden'
                                })
                            ),
                            
                            networkStatus.online && React.createElement('button', {
                                onClick: () => {
                                    syncOnlineData();
                                    setShowSyncModal(false);
                                },
                                className: 'flex items-center justify-center p-3 bg-gradient-to-r from-purple-50 to-purple-100 text-purple-700 rounded-lg hover:from-purple-100 hover:to-purple-200 transition border border-purple-200'
                            },
                                React.createElement(LucideIcons.Refresh, { className: 'mr-2' }),
                                'ƒê·ªìng b·ªô ngay'
                            )
                        )
                    )
                ),

                // Share Success Modal
                showShareModal && React.createElement('div', { className: 'fixed inset-0 flex items-center justify-center z-50 bg-black bg-opacity-60 p-4' },
                    React.createElement('div', { className: 'bg-white rounded-2xl p-6 max-w-sm w-full shadow-2xl' },
                        React.createElement('div', { className: 'text-center' },
                            React.createElement('div', { className: 'text-green-500 text-5xl mb-4' },
                                React.createElement(LucideIcons.CheckCircle, null)
                            ),
                            React.createElement('h3', { className: 'text-xl font-bold mb-2' }, 'T·∫£i v·ªÅ th√†nh c√¥ng!'),
                            React.createElement('p', { className: 'text-gray-600 mb-4' }, 'File APK ƒë√£ ƒë∆∞·ª£c t·∫£i xu·ªëng. B·∫°n c√≥ th·ªÉ g·ª≠i file n√†y cho ƒë·ªìng nghi·ªáp qua Zalo, Messenger ho·∫∑c email.'),
                            React.createElement('button', {
                                onClick: () => setShowShareModal(false),
                                className: 'w-full py-3 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg font-medium hover:from-blue-700 hover:to-blue-800 transition'
                            }, 'ƒê√£ hi·ªÉu')
                        )
                    )
                ),

                // Quick Tips
                React.createElement('div', { className: 'fixed bottom-24 left-4 z-10' },
                    React.createElement('button', {
                        onClick: () => alert('üì± M·∫∏O S·ª¨ D·ª§NG:\n\n1Ô∏è‚É£ Nh·∫•n v√†o thu·ªëc ƒë·ªÉ xem chi ti·∫øt\n2Ô∏è‚É£ Nh·∫•n ng√¥i sao ƒë·ªÉ l∆∞u thu·ªëc th∆∞·ªùng d√πng\n3Ô∏è‚É£ Th√™m thu·ªëc m·ªõi b·∫±ng n√∫t ‚ûï\n4Ô∏è‚É£ ƒê·ªìng b·ªô d·ªØ li·ªáu khi c√≥ m·∫°ng\n5Ô∏è‚É£ Export/Import ƒë·ªÉ sao l∆∞u\n6Ô∏è‚É£ Chia s·∫ª app v·ªõi ƒë·ªìng nghi·ªáp\n\nüåê ·ª®ng d·ª•ng ho·∫°t ƒë·ªông c·∫£ online v√† offline!'),
                        className: 'bg-gradient-to-r from-blue-600 to-blue-700 text-white p-3 rounded-full shadow-xl hover:shadow-2xl transition hover:scale-105'
                    },
                        React.createElement(LucideIcons.Info, { className: 'text-xl' })
                    )
                )
            );
        }

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
